<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/res/lib/layui/css/layui.css">
    <link rel="stylesheet" href="/res/lib/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/res/css/site.css">
    <link rel="stylesheet" href="/res/css/site-animate.css">
    <link rel="stylesheet" href="/res/css/site-media.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" />
    <link rel="stylesheet" href="/res/css/blog-pace.css" />
    <script data-pace-options='{ "ajax": false ,"eventLag": false}' src="/res/js/pace.min.js"></script>
    <script src="/res/lib/layui/layui.js"></script>
    <!-- 本页特有的css -->
    <link rel="stylesheet" href="/res/css/article-detail.css">
    <link rel="stylesheet" href="/res/css/wangEditor.css">
    <link rel="stylesheet" href="/res/css/prettify.css">
    <style type="text/css">
        code {
            font-size: 18px;
        }
    </style>
</head>

<body>
<!-- 头部 -->
<div id="head"></div>
<!-- 主体 -->
<div class="blog-body">
    <!-- 页面主体内容 -->
    <div class="layui-container">
        <blockquote class="layui-elem-quote sitemap shadow">
            <i class="layui-icon">&#xe715;</i>
            <span class="layui-breadcrumb" lay-separator=">">
                    <a href="index.html">首页</a>
                    <a  href="articlelist.html">学海无涯</a>
                    <a><cite>EF Core进阶之加载关联数据</cite></a>
                </span>
        </blockquote>
        <div class="layui-row layui-col-space15 clearfix">
            <div class="layui-col-md8 left" style="width:100% !important">
                <div data-fontsize="14" class="article-detail shadow">
                    <div class="article-tool">
                        <div id="title-bar" style="float:left;"></div>
                        <div class="tool-box">
                            <div class="layui-btn-group layui-hide-xs">
                                <button class="layui-btn layui-btn-primary layui-btn-xs" title="全屏阅读">
                                    <i class="fa fa-arrows-alt fa-fw"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="article-detail-title"></div>
                    <div id="markdown-content" style="font-size: 18px"></div>
                </div>
                <div class="article-component">
                    <div class="component-box">
                        <a href="javascript:;" class="praise" blog-event="praise"><i
                                class="fa fa-thumbs-up fa-fw"></i>点赞（<span id="praiseCnt">0</span>）</a>
                        <a href="javascript:;" class="reword" blog-event="reword">赏</a>
                        <a href="javascript:;" class="share" blog-event="share"><i
                                class="fa fa-share-alt fa-fw"></i>分享（<span id="shareCnt">0</span>）</a>
                    </div>
                </div>
                <div class="blog-card blog-card-padding shadow">
                    <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:0">
                        <legend>来说两句吧</legend>
                        <div class="layui-field-box">
                            <form class="layui-form blog-editor" action="">
                                <div class="layui-form-item">
                                        <textarea name="EditorContent" lay-verify="content" id="remarkEditor"
                                                  placeholder="请输入内容" class="layui-textarea layui-hide"></textarea>
                                    <!-- 禁止评论 -->
                                    <!-- <div style="border:1px solid #f2f2f2;" class="emptybox">
                                        <p><i style="font-size:50px;color:#5fb878" class="layui-icon">&#x1007;</i>
                                        </p>
                                        <p>该文章已禁止评论</p>
                                    </div> -->
                                </div>
                                <div class="layui-form-item">
                                    <button class="layui-btn" lay-submit="formRemark"
                                            lay-filter="formRemark">提交评论</button>
                                </div>
                            </form>
                        </div>
                    </fieldset>
                    <div class="blog-card-title">最新评论</div>
                    <ul class="blog-comment">
                        <li>
                            <div class="comment-parent">
                                <a name="remark-@item.Id"></a>
                                <img src="/res/images/Leo.jpg" alt="Leo" />
                                <div class="info">
                                    <span class="username">Leo</span>
                                </div>
                                <div class="content">评论扯淡呢</div>
                                <p class="info info-footer"><span class="time">2019-10-08 17：39：22</span><a href="javascript:;" class="btn-reply" data-targetname="Leo">回复</a></p>
                            </div>
                            <hr />
                            <div class="comment-child">
                                <a name="reply-@reply.Id"></a>
                                <img src="/res/images/Leo.jpg" alt="麻花疼" />
                                <div class="info">
                                    <span class="username">麻花疼</span>
                                    <span style="padding-right:0;margin-left:-5px;">回复</span>
                                    <span class="username">Leo</span>
                                    <span>第一条回复</span>
                                </div>
                                <p class="info"><span class="time">2019-10-08 17：39：22</span><a href="javascript:;" class="btn-reply" data-targetname="麻花疼">回复</a></p>
                            </div>
                            <div class="comment-child">
                                <a name="reply-@reply.Id"></a>
                                <img src="/res/images/Leo.jpg" alt="麻花疼" />
                                <div class="info">
                                    <span class="username">麻花疼</span>
                                    <span style="padding-right:0;margin-left:-5px;">回复</span>
                                    <span class="username">Leo</span>
                                    <span>第二条回复</span>
                                </div>
                                <p class="info"><span class="time">2019-10-08 17：39：22</span><a href="javascript:;" class="btn-reply" data-targetname="麻花疼">回复</a></p>
                            </div>
                            <!-- 回复编辑器 -->
                            <div class="replycontainer layui-hide">
                                <form class="layui-form" action="">
                                    <div class="layui-form-item"><textarea name="replyContent" lay-verify="replyContent" placeholder="请输入回复内容" class="layui-textarea" style="min-height:80px;"></textarea>
                                    </div>
                                    <div class="layui-form-item">
                                        <button class="layui-btn layui-btn-xs" lay-submit="formReply" lay-filter="formReply">提交</button>
                                    </div>
                                </form>
                            </div>
                        </li>
                        <li>
                            <div class="comment-parent">
                                <a name="remark-@item.Id"></a>
                                <img src="/res/images/Leo.jpg" alt="Leo" />
                                <div class="info">
                                    <span class="username">Leo</span>
                                </div>
                                <div class="content">评论扯淡呢</div>
                                <p class="info info-footer"><span class="time">2019-10-08 17：39：22</span><a href="javascript:;" class="btn-reply" data-targetname="Leo">回复</a></p>
                            </div>
                            <!-- 回复编辑器 -->
                            <div class="replycontainer layui-hide">
                                <form class="layui-form" action="">
                                    <div class="layui-form-item"><textarea name="replyContent" lay-verify="replyContent" placeholder="请输入回复内容" class="layui-textarea" style="min-height:80px;"></textarea>
                                    </div>
                                    <div class="layui-form-item">
                                        <button class="layui-btn layui-btn-xs" lay-submit="formReply" lay-filter="formReply">提交</button>
                                    </div>
                                </form>
                            </div>
                        </li>
                    </ul>
                    <!-- 没有评论 -->
                    <!-- <div class="emptybox">
                        <p><i style="font-size:50px;color:#5fb878" class="layui-icon"></i></p>
                        <p>暂无评论，大侠不妨来一发？</p>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 底部 -->
<div id="foot"></div>
<!-- 移动端侧边导航 -->
<div id="side"></div>
<!-- 侧边导航遮罩 -->
<div class="blog-mask animated layui-hide"></div>
<script src="/res/lib/jquery.min.js"></script>
<!-- 引用公共资源 -->
<script type="text/javascript">
    $(document).ready(function() {
        $("#foot").load("/html/foot.html");
        $("#head").load("/html/head.html", function () {
            headFunction();
        });
        $("#layout").load("/html/layout.html");
        $("#side").load("/html/side.html");
    });
</script>
<script src="https://cdn.bootcss.com/scrollReveal.js/3.3.6/scrollreveal.js"></script>
<script src="/res/js/site.js"></script>
<!-- 本页特有js -->
<script src="/res/js/prettify.js"></script>
<script type="text/javascript">
    var shareIndex, $;

    prettyPrint(); //渲染文章中的代码

    layui.use(['layer', 'form'], function () {
        $ = layui.$;
        var form = layui.form
            , device = layui.device();


        //文章顶部工具栏按钮点击事件
        $('.tool-box button').on('click', function () {
            var title = $(this).attr('title');
            switch (title) {
                case '全屏阅读':
                    var content = $('.article-detail').prop("outerHTML");
                    layer.open({
                        title: false,
                        type: 1,
                        content: content,
                        closeBtn: 0,
                        scrollbar: false,
                        area: ['100vw', '100vh'],
                        success: function (layero, index) {
                            $(layero).find('.article-tool').html('<div class="tool-box"><div class="layui-btn-group"><button class="layui-btn layui-btn-primary layui-btn-xs" title="关闭全屏"><i class="fa fa-compress fa-fw"></i></button></div></div>');
                            $(layero).find('.article-tool button').on('click', function () {
                                layer.close(index);
                            });
                        }
                    });
                    break;
                default:
            }
        });

        //回复按钮点击事件
        $('.btn-reply').on('click', function () {
            var targetId = $(this).data('targetid')
                , targetName = $(this).data('targetname')
                , $container = $(this).parent('p').parent().siblings('.replycontainer');
            if ($(this).text() == '回复') {
                $container.find('textarea').attr('placeholder', '回复【' + targetName + '】');
                $container.removeClass('layui-hide');
                $container.find('input[name="targetUserId"]').val(targetId);
                $(this).parents('.blog-comment li').find('.btn-reply').text('回复');
                $(this).text('收起');
            } else {
                $container.addClass('layui-hide');
                $container.find('input[name="targetUserId"]').val(0);
                $(this).text('回复');
            }
        });

        //监听留言回复提交
        form.on('submit(formReply)', function (data) {
            if ($(data.elem).hasClass('layui-btn-disabled')) {
                return false;
            }
            var index = layer.load(1);
            $.ajax({
                type: 'post',
                url: '/api/article/reply',
                data: data.field,
                success: function (res) {
                    layer.close(index);
                    if (res.code === 1) {
                        layer.msg(res.msg, { icon: 6 });
                        setTimeout(function () {
                            location.reload(true);
                        }, 500);
                    } else {
                        if (res.msg != undefined) {
                            layer.msg(res.msg, { icon: 5 });
                        } else {
                            layer.msg('程序异常，请重试或联系作者', { icon: 5 });
                        }
                    }
                },
                error: function (e) {
                    layer.close(index);
                    layer.msg("请求异常", { icon: 2 });
                }
            });
            return false;
        });
        var events = {
            //分享
            share: function () {
                layer.msg('使用的百度分享组件');
            }

            //点赞
            , praise: function () {
                var localdata = layui.data('blog')
                    , articleId = $('#hidArticleId').val()
                    , self = this;
                if (localdata['praise' + articleId]) {
                    layer.tips('你已点过赞了，若收获颇大，可打赏作者！^_^', self, { tips: 1, time: 2000 });
                    return;
                }
                //服务器点赞数加一
                //存储是否点赞该文
                layui.data('blog', {
                    key: 'praise' + $('#hidArticleId').val()
                    , value: true
                });
                //点赞+1
                var cnt = Number($('#praiseCnt').text()) + 1;
                $('#praiseCnt').text(cnt);
                layer.tips('Thank you ^_^', self, { tips: 1, time: 2000 });
            }

            //打赏
            , reword: function () {
                layer.tab({
                    area: ['330px', '373px'],
                    shade: 0.6,
                    tab: [{
                        title: '微信',
                        content: '<img style="width:330px;height:330px;" src="/res/images/wx_reward.png" />'
                    }, {
                        title: '支付宝',
                        content: '<img style="width:330px;height:330px;" src="/res/images/ali_reward.jpg" />'
                    }]
                });

            }
        };

        $('*[blog-event]').on('click', function () {
            var eventName = $(this).attr('blog-event');
            events[eventName] && events[eventName].call(this);
        });

        $('*[blog-event="reword"]').on('mouseover', function () {
            layer.tips('一元足以感动我 ^_^', this, { tips: 1, time: 2000 });
        });
    });
</script>
<!-- 使用marked引擎渲染markdown文档 -->
<script src="/res/js/marked.js"></script>
<script src="/res/js/highlight.min.js"></script>
<link rel="stylesheet" href="/res/css/a11y-dark.min.css">
<link rel="stylesheet" href="/res/css/custom-hight.css">
<script type="text/javascript" th:inline="javascript">
    marked.setOptions({
        renderer: new marked.Renderer(),
        highlight: function(code) {
            return hljs.highlightAuto(code).value;
        },
        pedantic: false,
        gfm: true,
        tables: true,
        breaks: false,
        sanitize: false,
        smartLists: true,
        smartypants: true,
        xhtml: false
    });
    let detail = [[${detail}]];
    let articleConetent = [[${articleContent}]];
    //文章数据渲染
    window.onload = function() {
        document.getElementsByClassName('article-detail-title')[0].innerHTML = detail.blogName;
        document.getElementById('markdown-content').innerHTML = marked.parse(articleConetent);
        document.getElementById('title-bar').innerHTML = "<button class=\"layui-btn layui-btn-primary layui-btn-xs\" title=\"发布日期\">\n" +
                            "                                " + detail.createTime + "</button>\n" +
                            "                            <div class=\"layui-btn-group\">\n" +
                            "                                <button class=\"layui-btn layui-btn-primary layui-btn-xs\" title=\"浏览\">\n" +
                            "                                    <i class=\"fa fa-eye fa-fw\"></i><span style=\"margin-left:3px;\">28</span>\n" +
                            "                                </button>\n" +
                            "                                <button class=\"layui-btn layui-btn-primary layui-btn-xs\" title=\"评论\">\n" +
                            "                                    <i class=\"fa fa-comments fa-fw\"></i><span style=\"margin-left:3px;\">0</span>\n" +
                            "                                </button>\n" +
                            "                            </div>"
    }
</script>
</body>

</html>
